---
title: "Complete Ubuntu VM Setup with LVM Storage and NFS Shares"
icon: "/icons/ubuntu.svg"
description: "A comprehensive guide to setting up an Ubuntu virtual machine with LVM storage and NFS shares."
tags: ["Ubuntu", "LVM", "NFS", "Virtual Machine", "Storage"]   
keywords: ["Ubuntu", "LVM", "NFS", "Virtual Machine", "Storage", "Setup Guide"]
---
## Introduction
Setting up an Ubuntu virtual machine (VM) with Logical Volume Management (LVM) storage and  Network File System (NFS) shares can enhance your system's flexibility and scalability. This guide provides a step-by-step approach to configuring an Ubuntu VM with LVM for efficient storage management and NFS for sharing files across the network.  
<Info>
## Prerequisites
Before you begin, ensure you have the following prerequisites: 
- An preferred virtualization platform (e.g., VirtualBox, VMware, KVM).
- An Ubuntu ISO image for installation.
- Basic knowledge of Linux command line and system administration.
</Info>
## Step 1: Installing Ubuntu VM
1. Create a new virtual machine in your chosen virtualization platform.
2. Allocate sufficient resources (CPU, RAM, Disk Space) based on your requirements.
3. Mount the Ubuntu ISO image and start the VM.
4. Follow the on-screen instructions to install Ubuntu, ensuring you set up a user account and password.
5. In the installation process keep the unallocated or free space as it is.
6. Complete the installation and reboot the VM.
## Step 2: Enable remote root access:
1. Open a terminal in your Ubuntu VM.
2. Use below command to set root password
```bash
sudo passwd root
```
3. Command to enable remote root login
```bash
sudo sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config
sudo systemctl restart sshd
```
## Step 3: Install root CA certificates in the trust store
1. Copy the root CA certificate file (e.g., `my-ca.crt`) to the `/usr/local/share/ca-certificates/` directory.
```bash
sudo cp my-ca.crt /usr/local/share/ca-certificates/
```
2. Update the CA certificates:
```bash 
sudo update-ca-certificates
```
## Step 4: Setting Up LVM Storage
1. Show the availabls space using below command
```bash
vgs
```
you will see the free space in the VG like below:
```plaintext
   VG        #PV #LV #SN Attr   VSize    VFree
  ubuntu-vg   1   1   0 wz--n- <498.00g <398.00g
```
2. to see the absolute free space use below command
```bash
pvs 
```
you will see the free space in the PV like below:
```plaintext
  PV         VG        Fmt  Attr PSize    PFree
  /dev/sda3  ubuntu-vg lvm2 a--  <498.00g <398.00g
```
3. Create a new logical volume (LV) using the free space:
```bash
sudo lvcreate -L 300G -n nfs-share ubuntu-vg # Replace '300G' with the desired size and 'nfs-share' with your LV name
```
It will create a LV named nfs-share with 300GB size. give the terminal output like below:
```plaintext
  Logical volume "nfs-share" created.
```
4. Format the new LV with a filesystem (e.g., xfs):
```bash
sudo mkfs.xfs /dev/ubuntu-vg/nfs-share # Replace with your LV path  
```
you will see the terminal output like below:
```plaintext
meta-data=/dev/ubuntu-vg/nfs-share isize=512    agcount=4, agsize=19660800 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=1
         =                       reflink=1    bigtime=1 inobtcount=1 nrext64=0
data     =                       bsize=4096   blocks=78643200, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=38400, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
Discarding blocks...Done.
```
5. Create a mount point and mount the LV:
```bash
sudo mkdir -p /mnt/nfs-share
sudo mount /dev/ubuntu-vg/nfs-share /mnt/nfs-share
```
6. To make the mount persistent across reboots, add an entry to `/etc/fstab`:
```bash
echo '/dev/ubuntu-vg/nfs-share /mnt/nfs-share xfs defaults 0 0' | sudo tee -a /etc/fstab
```
It will append the fstab file with the new entry. and command output like below:
```plaintext
/dev/ubuntu-vg/nfs-share /mnt/nfs-share xfs defaults 0 0
```
## Step 5: Setting Up NFS Shares
1. Install NFS server packages:
```bash
sudo apt update
sudo apt install nfs-kernel-server -y
```

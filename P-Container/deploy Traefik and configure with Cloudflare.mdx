---
title: "Deploy Traefik and Configure with Cloudflare"
---

## Introduction
In this guide, we will walk through the steps to deploy <Icon icon="/icons/Traefik Proxy.svg" iconType="solid" />Traefik, a popular open-source reverse proxy and load balancer, and configure it to work with Cloudflare for enhanced security and performance.
<Info>
  ## Prerequisites
    Before we begin, ensure you have the following prerequisites in place:
    - A server or virtual machine with Docker installed.
    - A Cloudflare account with a domain configured.
    - Basic knowledge of Docker and Traefik.
</Info>
## Logical Diagram
```plaintext
+-------------------+          +------------------+
|                   |          |                  |
|   Client Browser  +--------->|   Cloudflare     |
|                   |          |                  |
+-------------------+          +--------+---------+
                                        |                     +------------------+
                                        |                     |                  |  
                                        +-------------------->  Traefik Reverse  |      
                                                              |     Proxy        |
                                                              |                  |
                                                              +--------+---------+
                                                                       |
                                                                       |
                                                              +--------v---------+
                                                              |                  |
                                                              |   Backend Apps   |
                                                              |                  |
                                                              +------------------+            
```         
## Deploy Traefik with Docker
    <Steps>
    <Step title="'docker-compose.yml' File Creation">
    Create a `docker-compose.yml` file to define the Traefik service:
    ```yaml
        # Define the services to be run by Docker Compose
        services:
        traefik:
            image: traefik:v3.4  # Use Traefik version 3.4 image
            container_name: traefik  # Name the container "traefik"
            restart: unless-stopped  # Always restart unless explicitly stopped
            security_opt:
            - no-new-privileges:true  # Prevent container from gaining new privileges
            ports:
            - "80:80"    # Expose HTTP on port 80
            - "443:443"  # Expose HTTPS on port 443
            environment:
            - TZ=Asia/Dhaka  # Set timezone
            - CF_API_EMAIL=your-cloudflare-email@example.com  # Cloudflare account email for DNS challenge
            - CF_DNS_API_TOKEN=your-cloudflare-dns-token      # Cloudflare API token for DNS challenge
            volumes:
        - ./traefik-data/acme.json:/acme.json
        # Make sure acme.json exists, is chmod 600, and owned by the Traefik user to avoid permission errors.
        - ./traefik-data/traefik.yml:/etc/traefik/traefik.yml
            - ./traefik-data/traefik.yml:/etc/traefik/traefik.yml  # Traefik static configuration file
            networks:
            - web  # Attach to the external "web" network
            labels:
            - "traefik.enable=true"  # Enable Traefik for this container
            # Dashboard configuration
            - "traefik.http.routers.dashboard.rule=Host(`traefik.your-domain.com`)"  # Dashboard accessible at this domain
            - "traefik.http.routers.dashboard.service=api@internal"  # Use Traefik's internal API service
            - "traefik.http.routers.dashboard.tls=true"  # Enable TLS for the dashboard
            - "traefik.http.routers.dashboard.tls.certresolver=cloudflare"  # Use Cloudflare DNS challenge for certificates
            - "traefik.http.routers.dashboard.entrypoints=websecure"  # Use the "websecure" entrypoint (usually port 443)
            - "traefik.http.routers.dashboard.middlewares=dashboard-auth"  # Protect dashboard with basic auth
            - "traefik.http.middlewares.dashboard-auth.basicauth.users=admin:$$2y$$XXXXXXXXXXXXXXX"  # Basic auth user (bcrypt hash)
        networks:
            web:
            external: true     # Use an existing external network named "web" 
    ```
    </Step>

    <Step title="Preview locally">

    Navigate to your docs directory where your `docs.json` file is located, and run the following command:

    ```bash
    mint dev
    ```

    A local preview of your documentation will be available at `http://localhost:3000`.

    </Step>
    </Steps>
1. Create a `docker-compose.yml` file to define the Traefik service:
    ```yaml
        # Define the services to be run by Docker Compose
        services:
        traefik:
            image: traefik:v3.4  # Use Traefik version 3.4 image
            container_name: traefik  # Name the container "traefik"
            restart: unless-stopped  # Always restart unless explicitly stopped
            security_opt:
            - no-new-privileges:true  # Prevent container from gaining new privileges
            ports:
            - "80:80"    # Expose HTTP on port 80
            - "443:443"  # Expose HTTPS on port 443
            environment:
            - TZ=Asia/Dhaka  # Set timezone
            - CF_API_EMAIL=your-cloudflare-email@example.com  # Cloudflare account email for DNS challenge
            - CF_DNS_API_TOKEN=your-cloudflare-dns-token      # Cloudflare API token for DNS challenge
            volumes:
        - ./traefik-data/acme.json:/acme.json
        # Make sure acme.json exists, is chmod 600, and owned by the Traefik user to avoid permission errors.
        - ./traefik-data/traefik.yml:/etc/traefik/traefik.yml
            - ./traefik-data/traefik.yml:/etc/traefik/traefik.yml  # Traefik static configuration file
            networks:
            - web  # Attach to the external "web" network
            labels:
            - "traefik.enable=true"  # Enable Traefik for this container
            # Dashboard configuration
            - "traefik.http.routers.dashboard.rule=Host(`traefik.your-domain.com`)"  # Dashboard accessible at this domain
            - "traefik.http.routers.dashboard.service=api@internal"  # Use Traefik's internal API service
            - "traefik.http.routers.dashboard.tls=true"  # Enable TLS for the dashboard
            - "traefik.http.routers.dashboard.tls.certresolver=cloudflare"  # Use Cloudflare DNS challenge for certificates
            - "traefik.http.routers.dashboard.entrypoints=websecure"  # Use the "websecure" entrypoint (usually port 443)
            - "traefik.http.routers.dashboard.middlewares=dashboard-auth"  # Protect dashboard with basic auth
            - "traefik.http.middlewares.dashboard-auth.basicauth.users=admin:$$2y$$XXXXXXXXXXXXXXX"  # Basic auth user (bcrypt hash)
        networks:
            web:
            external: true     # Use an existing external network named "web" 
    ```
<note>
    # NOTE: Replace the placeholder bcrypt hash above with a real hash. You can generate one at https://bcrypt-generator.com/ or using the `htpasswd` tool.
    # Define external network for Traefik to communicate with other services
 </note>
            
2. Create the necessary directories and files and change the directory permission for Traefik configuration:
   ### Create the directory for Traefik data if it doesn't exist
   ```bash
    mkdir -p traefik-data
    ```
    ### Create the acme.json file to store TLS certificates 
    ```bash
    touch traefik-data/acme.json
    ```
   ### Set strict permissions so only the owner can read/write (required by Traefik)
   ```bash  
    chmod 600 traefik-data/acme.json
   ```
3. Create the `traefik.yml` configuration file inside the `traefik-data` directory:
   ```yaml
   api:
    dashboard: true
    insecure: false

    entryPoints:
    web:
        address: :80
        http:
        redirections:
            entryPoint:
            to: websecure
            scheme: https
    websecure:
        address: :443

    providers:
    docker:
        exposedByDefault: false
        network: web

    certificatesResolvers:
    cloudflare:
        acme:
        email: your email address
        storage: /acme.json
        dnsChallenge:
            provider: cloudflare
            resolvers:
            - "1.1.1.1:53"
            - "8.8.8.8:53"
    log:
    level: error

    ``` 
4. Start the Traefik container using Docker Compose:
   ```bash
   docker-compose up -d
   ```
## Step 2: Configure Cloudflare DNS 
1. Log in to your Cloudflare account and navigate to the DNS settings for your domain.
2. Add a CNAME record for your Traefik dashboard:
   - Type: CNAME
   - Name: traefik  
    - Target: your-server-ip-or-domain
    - TTL: Auto
3. Ensure that the proxy status is enabled (orange cloud icon) for the CNAME record.
## Step 3: Access the Traefik Dashboard
1. Open your web browser and navigate to `https://traefik.your-domain.com`.
2. You should see the Traefik dashboard login prompt. Enter the username and password you configured in the `docker-compose.yml` file.
3. Once logged in, you can monitor and manage your Traefik instance.
## Conclusion
You have successfully deployed Traefik and configured it to work with Cloudflare. You can now take advantage of Traefik's powerful features along with Cloudflare's security and performance enhancements for your